let accordionItemBtn = document.querySelectorAll(".accordion__item-btn");
accordionItemBtn.forEach((e => { e.addEventListener("click", (() => { e.parentElement.classList.toggle("active"); })); }));
let modalBoxAnswer = document.querySelectorAll(".modal__box-answer");
modalBoxAnswer.forEach((e => { e.addEventListener("click", (() => { e.classList.toggle("active"); })); }));
let modalBoxClose = document.querySelectorAll(".modal__box-close");
modalBoxClose.forEach((e => { e.addEventListener("click", (() => { modalBox.forEach((e => { e.classList.remove("active"); })), document.querySelector(".modal__box").classList.add("active"), modalBoxAnswer.forEach((e => { e.classList.remove("active"); })); })); }));
let modalBoxBtn = document.querySelectorAll(".modal__box-btn"),
    modalBox = document.querySelectorAll(".modal__box");
let activeModal = document.querySelector(".modal__box.active");

modalBoxBtn.forEach((btn, i) => {
  btn.addEventListener("click", () => {
    
    // получаем выбранный вариант ответа на текущем шаге
    const currentAnswerText = document.querySelector('.modal__box.active .modal__box-answer.active')?.textContent.trim();

    // если в предпоследнем ответе выбрано "Вы своими силами"
    if (currentAnswerText === 'Вы своими силами' || currentAnswerText === 'Вы сами') {
      // проверяем, есть ли следующий шаг
      if (i + 2 < modalBox.length - 1) {
        // убираем класс active у текущего блока
        activeModal.classList.remove("active");
          
        // добавляем класс active следующему блоку
        modalBox[i+2].classList.add("active");
        // устанавливаем новый active для последующих кликов
        activeModal = modalBox[i+2];
      } else {
        // ситуация, когда выбран последний ответ "Вы своими силами",
        // и в следующем шаге уже нет блока для добавления - можно отправлять форму
        document.querySelector('.modal__box-form').submit();
      }
    } else {
      // выбран другой ответ
      // убираем класс active у текущего блока
      activeModal.classList.remove("active");
      
      // добавляем класс active следующему блоку
      modalBox[i+1].classList.add("active");
      
      // устанавливаем новый active для последующих кликов
      activeModal = modalBox[i+1];
    }
  });
});

//запись ответов
// получаем все кнопки
const btns = document.querySelectorAll('.modal__box-answer');

btns.forEach(btn => {
  btn.addEventListener('click', () => {
    const answerText = btn.textContent.trim();
    const question = btn.getAttribute("data-question");

    // удаляем класс active у других вариантов ответа в этом блоке
    const answersInBlock = btn.parentElement.querySelectorAll('.modal__box-answer');
    answersInBlock.forEach(answer => {
      if (answer !== btn && answer.classList.contains('active')) {
        answer.classList.remove('active');
      }
    });

    // удаляем или меняем инпут в зависимости от наличия уже имеющегося инпута
    const existingInput = document.querySelector(`input[name="answer[${question}]`);
    if (existingInput) {
      existingInput.value = answerText;
    } else {
      const newInput = document.createElement('input');
      newInput.type = 'hidden';
      newInput.name = `answer[${question}]`; 
      newInput.value = answerText;
      document.querySelector('.modal__box-form').appendChild(newInput);
    }

    // добавляем класс active к этому варианту ответа
    btn.classList.add('active');
  });
});


let backBtn = document.querySelectorAll(".modal__box-back");

backBtn.forEach((btn, i) => {
  btn.addEventListener("click", () => {
    activeModal.classList.remove("active");
    modalBox[i].classList.add("active");
    activeModal = modalBox[i]; 
  });
});